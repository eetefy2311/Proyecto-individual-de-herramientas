"0","library(ranger)"
"0",""
"0","set.seed(123)"
"0",""
"0","datos <- base.filtrada %>%"
"0","  mutate(Lat.abs = abs(Latitude_Degrees)) %>%"
"0","  select(Percent_Bleaching, SSTA_Maximum, Cyclone_Frequency, Lat.abs, Date_Year) %>%"
"0","  drop_na()"
"0",""
"0","n <- nrow(datos)"
"0","idx <- sample(seq_len(n), size = floor(0.8 * n))"
"0","train <- datos[idx, ]"
"0","test  <- datos[-idx, ]"
"0",""
"0","rf.mod <- ranger("
"0","  Percent_Bleaching ~ SSTA_Maximum + Cyclone_Frequency + Lat.abs + Date_Year,"
"0","  data = train,"
"0","  num.trees = 600,"
"0","  mtry = 3,"
"0","  min.node.size = 5,"
"0","  importance = ""permutation"","
"0","  seed = 123"
"0",")"
"0",""
"0","pred.test <- predict(rf.mod, data = test)$predictions"
"0",""
"0","rmse <- sqrt(mean((pred.test - test$Percent_Bleaching)^2))"
"0","r2   <- cor(pred.test, test$Percent_Bleaching)^2"
"0","c(RMSE = rmse, R2 = r2)"
"1","      RMSE "
"1","        R2 "
"1","
"
"1","14.3984154 "
"1"," 0.6045577 "
"1","
"
"0","plt6 <- ggplot(data.frame(obs = test$Percent_Bleaching, pred = pred.test),"
"0","       aes(x = obs, y = pred)) +"
"0","  geom_point(aes(color = pred - obs), size = 2, alpha = 0.8) +"
"0","  geom_abline(slope = 1, intercept = 0, color = ""blue"", linewidth = 2) +"
"0","  scale_color_viridis_c(option = ""magma"", direction = -1, name = ""Error"") +"
"0","  coord_equal(xlim = c(0, 100), ylim = c(0, 100), expand = FALSE) +"
"0","  labs(title = ""Predicho vs observado (Random Forest)"","
"0","       x = ""Observado (%)"", y = ""Predicho (%)"") +"
"0","  theme_minimal(base_size = 13)"
"0",""
"0","ggsave(here(""res"", ""modelo.pdf""), plt6, width = 6, height = 4)"
